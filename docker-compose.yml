version: '3.8'

# This file orchestrates your three custom applications
services:

  # 1. Frontend (Next.js)
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    ports:
      - "3000:3000"
    env_file:
      - ./frontend/.env
    # Depends on both backends being started
    depends_on:
      - nodejs-server
      - fastapi-server
    container_name: finsight-frontend

  # 2. NodeJS Server (Backend)
  nodejs-server:
    build:
      context: ./nodejs-server
      dockerfile: Dockerfile
    ports:
      # Exposing port 5000 to the host machine
      - "5000:5000"
    env_file:
      - ./nodejs-server/.env
    # This service name 'nodejs-server' is its hostname inside the network
    container_name: finsight-nodejs-server
    # We removed 'depends_on: - mongo' since it's now external

  # 3. FastAPI Server (Orchestrator)
  fastapi-server:
    build:
      context: ./fastapi-server
      dockerfile: Dockerfile
    ports:
      # Exposing port 8000 to the host machine
      - "8000:8000"
    env_file:
      - ./fastapi-server/.env
    # This service only depends on the Node server now
    depends_on:
      - nodejs-server
    container_name: finsight-fastapi-server
    # We removed 'depends_on: - ollama'

# No volumes are needed since Mongo/Ollama are external
volumes: {}